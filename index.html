<!doctype html>
<!--animaciÃ³n de nave espacial-->
<html lang="en-US">
	<head>
	<meta charset="utf-8"/> 
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="apple-mobile-web-app-capable" content="yes">
    	<script src="aframe-v1.7.1.min.js"></script>
    	<script src="aframe-ar.js"></script>
		<script src="aframe-extras.js"></script>
		<link rel="stylesheet" href="styles.css">
	</head>
		
	<body style="margin : 0px; overflow: hidden;">
	<div class="buttons">
 	 <button id="boton" class="button" type="button" onclick="funcion_play()">Reproducir</button>
	</div>
    <a-scene arjs embedded renderer="logarithmicDepthBuffer: true;" xr-mode-ui="enabled: true">
      <a-assets>
        <a-asset-item id="nave" src="starship_anim.glb">
        </a-asset-item>
      </a-assets>
      
		<a-entity id="modelo_nave" gltf-model="#nave" position="0 0 0" rotation="0 0 0" scale="0.25 0.25 0.25" animation-mixer="clip:*;timeScale:0;">
		</a-entity>
		<a-entity look-controls position="0 1 10" camera></a-entity>
		
  </a-scene>
</body>
	<script>
		let modelo3d= document.getElementById("modelo_nave");
		const scene = document.querySelector('a-scene');
		var camera = null;
		modelo3d.addEventListener('model-loaded',()=>{
		const mesh = modelo3d.getObject3D('mesh');
  		mesh.traverse(node=>{
   			if(node.isMesh){
      const gltf_camera = mesh.getObjectByName('camara_1');
      scene.camera=gltf_camera;
			}
		});
	});

function funcion_play()
{
	//const mixerComponent = modelo3d.components['animation-mixer'];
	modelo3d.setAttribute('animation-mixer','clip:*;loop:once;timeScale: 0.3;clampWhenFinished:false');
	modelo3d.addEventListener('animation-finished',()=>{
		const mixerComponent = modelo3d.components['animation-mixer'];
		const action1 = mixerComponent.mixer.clipAction('CameraAction');
		const action2 = mixerComponent.mixer.clipAction('ArmatureAction');
		action1.reset();
	  	action2.reset();
  //modelo3d.setAttribute('animation-mixer','timeScale:0');
  //console.log("anim terminada")
});//finished
	if(mixerComponent && mixerComponent.mixer)
    {
      /*const clipName = mixerComponent.data.clip;
	  const action = mixerComponent.mixer.clipAction(clipName);*/
	  //mixerComponent.data.clip.reset();
	  //console.log("click actions")
	  /*const clipName1 = modelo3d.animations.find((clip)=>clip.name==='CameraAction');
	  const clipName2 = modelo3d.animations.find((clip)=>clip.name==='ArmatureAction');
      const action1 = mixer.clipAction(clipName1);
	  const action2 = mixer.clipAction(clipName2);
	console.log("anim1",clipName1)
	console.log("anim2",clipName2)
      action1.reset();
	  action2.reset();*/
    }
}
	</script>
</html>
